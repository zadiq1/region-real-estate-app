<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Property Listings | DreamSpace Real Estate</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container">
      <h1 class="logo">Region</h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="listings.html" class="active">Properties</a></li>
          <li><a href="construction.html">Construction</a></li>
          <li><a href="management.html">Management</a></li>
          <li><a href="store.html">Materials Store</a></li>
          <li><a href="consulting.html">Consulting</a></li>
          <li><a href="notary.html">Notary</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <h2 style="margin: 2rem 0;">Browse Properties</h2>

    <!-- Filters -->
    <div style="margin-bottom: 2rem;">
      <label for="type">Type:</label>
      <select id="type">
        <option value="all">All</option>
        <option value="house">House</option>
        <option value="land">Land</option>
        <option value="apartment">Apartment</option>
        <option value="commercial">Commercial</option>
      </select>

      <label for="status">Status:</label>
      <select id="status">
        <option value="all">All</option>
        <option value="sale">For Sale</option>
        <option value="rent">For Rent</option>
      </select>

      <label for="minPrice">Min Price:</label>
      <input type="number" id="minPrice" placeholder="0" style="width:100px;" />

      <label for="maxPrice">Max Price:</label>
      <input type="number" id="maxPrice" placeholder="1000000" style="width:100px;" />

      <button onclick="applyFilters()">Apply Filters</button>
    </div>

    <!-- Property Listings -->
    <div class="listings-container" id="listings"></div>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>Â© 2025 DreamSpace Real Estate. All rights reserved.</p>
  </footer>

  <script>
    // ðŸ”§ Firebase setup
    const firebaseConfig = {
      apiKey: "AIzaSyAAoPIw61ZsZB8C7zH4183yWUqh44uwbgA",
      authDomain: "dreamspace-8f29c.firebaseapp.com",
      projectId: "dreamspace-8f29c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const listingsContainer = document.getElementById('listings');
    let allListings = [];

    // Load listings
    db.collection("listings").get().then(snapshot => {
      if (snapshot.empty) {
        listingsContainer.innerHTML = "<p>No properties available.</p>";
        return;
      }

      allListings = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderListings(allListings);
    });

    function renderListings(list) {
      listingsContainer.innerHTML = "";
      if (list.length === 0) {
        listingsContainer.innerHTML = "<p>No matching properties found.</p>";
        return;
      }

      list.forEach(d => {
        listingsContainer.innerHTML += `
          <div class="property-card" data-type="${d.type}" data-status="${d.status}" data-price="${d.price}">
            <img src="${d.image}" alt="${d.title}" />
            <div class="property-card-content">
              <h3>${d.title}</h3>
              <p>${d.desc}</p>
              <strong>$${d.price.toLocaleString()}</strong><br><br>
              <a href="property.html?id=${d.id}">View Details</a>
            </div>
          </div>
        `;
      });
    }

    // Filter logic
    function applyFilters() {
      const type = document.getElementById('type').value.toLowerCase();
      const status = document.getElementById('status').value.toLowerCase();
      const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
      const maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;

      const filtered = allListings.filter(p => {
        return (
          (type === 'all' || p.type.toLowerCase() === type) &&
          (status === 'all' || p.status.toLowerCase() === status) &&
          p.price >= minPrice && p.price <= maxPrice
        );
      });

      renderListings(filtered);
    }
  </script>
</body>
</html>
